(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2867:(e,t,s)=>{"use strict";s.d(t,{default:()=>X});var a=s(5155),r=s(2115),l=s(5695),n=s(7168),i=function(e){return e.IN_PROGRESS="inProgress",e.LEARNED="learned",e.NEW="new",e}({}),c=s(3682),o=s(7296);class d{static getInstance(){return d.instance||(d.instance=new d),d.instance}mapSetResponseToSet(e){return{id:e.id,words:e.words.map(e=>this.mapWordResponseToJapaneseWord(e)),state:this.mapSetStateToCollection(e.state)}}mapWordResponseToJapaneseWord(e){return{id:e.id,word:e.word,reading:e.reading||"",meaning:e.translation}}async getLearnedWords(e){return(await o.K.listReleasedWords(e)).map(e=>this.mapWordResponseToJapaneseWord(e))}async getInProgressSets(){return(await o.K.listCurrentSets()).map(e=>this.mapSetResponseToSet(e))}async getUnlearnedSets(){return(await o.K.listTobeSets()).map(e=>this.mapSetResponseToSet(e))}async markSetAsLearned(e){await o.K.markAsFinished(e)}async moveToInProgress(e){await o.K.markAsCurrent(e)}async getOverview(){return await o.K.getOverview()}async getSetById(e){let t=await o.K.getSet(e);return this.mapSetResponseToSet(t)}mapSetStateToCollection(e){switch(e){case c.OM.CURRENT:return i.IN_PROGRESS;case c.OM.TOBE:default:return i.NEW}}mapApiExtractedWordToExtractedWord(e){return{word:e.word,reading:e.reading||null,translation:e.translation}}async extractWordsFromText(e){return(await o.K.extractWordsFromText(e)).map(this.mapApiExtractedWordToExtractedWord)}async extractWordsFromImage(e){return(await o.K.extractWordsFromImage(e)).map(this.mapApiExtractedWordToExtractedWord)}async saveWords(e){await o.K.saveWords(e)}async markAsCurrent(e){await o.K.markAsCurrent(e)}async markAsFinished(e){await o.K.markAsFinished(e)}async markAsTobe(e){await o.K.markAsTobe(e)}constructor(){}}var x=s(8250),u=s(2098),m=s(3509),h=s(1362);function g(){let[e,t]=(0,r.useState)(!1),{theme:s,setTheme:l}=(0,h.D)();return((0,r.useEffect)(()=>{t(!0)},[]),e)?(0,a.jsx)("button",{onClick:()=>l("dark"===s?"light":"dark"),className:"p-2 rounded-md ".concat(x.Tj.ui.button.modeToggle.inactiveHoverBg," transition-colors"),"aria-label":"Toggle theme",children:"dark"===s?(0,a.jsx)(u.A,{className:"h-5 w-5 ".concat(x.Tj.ui.text.primary)}):(0,a.jsx)(m.A,{className:"h-5 w-5 ".concat(x.Tj.ui.text.slate)})}):null}let j=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 ".concat(x.Tj.ui.toolbar.bg," backdrop-blur-sm ").concat(x.Tj.ui.toolbar.border),children:(0,a.jsx)("div",{className:"max-w-screen-lg mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-16",children:[t,(0,a.jsx)(g,{})]})})})},p=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"min-h-screen pt-32",children:t})};var v=s(4616);let f=e=>{let{words:t,onClick:s,bgColor:l=x.Tj.ui.background.main,borderColor:n=x.Tj.ui.border.default,delay:i=0}=e,[c,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{u(!0)},[]),d)?(0,a.jsx)("div",{style:{width:160,height:192,animationDelay:"".concat(i,"ms")},children:(0,a.jsx)("div",{className:"relative cursor-pointer group",onClick:s,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:t.slice(0,Math.min(t.length,5)).map((e,s)=>{let r=Math.min(t.length,5),i=c?(s-Math.floor(r/2))*15:(s-Math.floor(r/2))*8,o=c?8*Math.abs(s-Math.floor(r/2)):4*Math.abs(s-Math.floor(r/2));return(0,a.jsx)("div",{className:"absolute rounded-lg border-2 shadow-xl transition-all duration-500 ease-out ".concat(l," ").concat(n),style:{width:128,height:160,transform:"\n                  translateX(".concat(c?15*s-(r-1)*7.5:8*s-(r-1)*4,"px)\n                  translateY(").concat(o+(c?-8:0),"px)\n                  rotateX(2deg)\n                  rotateZ(").concat(i,"deg)\n                  scale(").concat(c?1.05:1,")\n                "),zIndex:50+s,transformStyle:"preserve-3d"},children:(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-normal ".concat(x.Tj.ui.text.slate," mb-1"),children:e.word}),(0,a.jsx)("div",{className:"text-sm ".concat(x.Tj.ui.text.blue," mb-1"),children:e.reading}),(0,a.jsx)("div",{className:"text-xs ".concat(x.Tj.ui.text.slate," text-center px-1 leading-tight"),children:e.meaning})]})},"fan-".concat(s))})})}):(0,a.jsx)("div",{className:"group cursor-pointer",style:{width:"160px",height:"192px",animationDelay:"".concat(i,"ms")}})},b=e=>{let{count:t,bgColor:s,borderColor:l,onClick:n,isAddDeck:i=!1,words:c=[],title:o}=e,[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{h(!0)},[]),m)?!i&&c.length>0?(0,a.jsxs)("div",{className:"group cursor-pointer p-6 flex items-center",children:[(0,a.jsx)("div",{className:"flex justify-center items-center",style:{width:"300px",height:"200px"},children:(0,a.jsx)(f,{words:c,onClick:n,bgColor:s,borderColor:l})}),(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-1",children:o}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[t," слов"]})]})]}):(0,a.jsxs)("div",{className:"group cursor-pointer p-6 flex items-center",onClick:n,children:[(0,a.jsx)("div",{className:"relative flex-shrink-0",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),style:{perspective:"1000px",width:"300px",height:"200px"},children:Array.from({length:i?3:4}).map((e,r)=>{let n=d?3*r:2*r,c=r===(i?2:3);return(0,a.jsxs)("div",{className:"absolute rounded-xl border-2 shadow-lg transition-all duration-700 ease-out ".concat(i?"".concat(x.Tj.deck.add.bg," ").concat(x.Tj.deck.add.border):0===t?"bg-gray-100 border-gray-300 animate-pulse":"".concat(s," ").concat(l)),style:{width:"120px",height:"160px",transform:"\n                 translateX(".concat(40+n,"px)\n                 translateY(").concat(-n,"px)\n                 rotateX(2deg)\n               "),zIndex:r+1,transformStyle:"preserve-3d"},children:[i&&2===r&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(v.A,{className:"h-8 w-8 ".concat(x.Tj.deck.add.text)})}),!i&&0===t&&c&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-gray-300 rounded mb-2 animate-pulse"}),(0,a.jsx)("div",{className:"h-8 w-12 bg-gray-300 rounded animate-pulse"})]})]},"deck-".concat(r))})}),!i&&(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-1",children:o}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[t," слов"]})]}),i&&(0,a.jsx)("div",{className:"ml-2",children:(0,a.jsx)("h3",{className:"text-lg font-semibold mb-1",children:o})})]}):(0,a.jsx)("div",{className:"group cursor-pointer p-6",style:{width:"300px",height:"200px"}})},y=e=>{let{setViewMode:t,setSelectedSetList:s,setSelectedSet:n}=e,c=(0,l.useRouter)(),[o,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!0),[g,v]=(0,r.useState)(null),[f,y]=(0,r.useState)(null),N=async()=>{try{let e=d.getInstance(),t=await e.getOverview();v(t),y(null)}catch(e){console.error("Error loading overview:",e),y("Ошибка загрузки данных. Попробуйте обновить страницу."),v(null)}finally{h(!1)}},w=e=>({id:e.id,word:e.word,reading:e.reading||"",meaning:e.translation}),S=async e=>{try{let a=d.getInstance(),r=[];switch(e){case i.LEARNED:let l=await a.getLearnedWords(void 0);r=[{id:"learned",words:l,state:i.LEARNED}];break;case i.IN_PROGRESS:r=await a.getInProgressSets();break;case i.NEW:r=await a.getUnlearnedSets()}s({type:e,sets:r}),n({type:e,set:null}),c.push("?type=".concat(e)),t("set-selection")}catch(e){console.error("Error loading sets:",e)}};return((0,r.useEffect)(()=>{(async()=>{u(!0),await N()})()},[]),!o||m)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"日本語"})})}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"w-full space-y-12 max-w-screen-lg mx-auto px-4 pt-20",children:(0,a.jsx)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-12 max-w-7xl mx-auto",children:Array.from({length:4}).map((e,t)=>(0,a.jsx)("div",{className:"group cursor-pointer p-6 bg-gray-200 animate-pulse rounded-lg",style:{width:"300px",height:"200px"}},t))})})})]}):f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"日本語"})})}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Ошибка загрузки"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:f}),(0,a.jsx)("button",{onClick:()=>{y(null),h(!0),N()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Повторить попытку"})]})})})]}):g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"日本語"})})}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"w-full space-y-12 max-w-screen-lg mx-auto px-4 pt-20",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-12 max-w-7xl mx-auto",children:[(0,a.jsx)(b,{count:(null==g?void 0:g.finished.total_words)||0,bgColor:x.Tj.deck.learned.bg,borderColor:x.Tj.deck.learned.border,onClick:()=>S(i.LEARNED),words:(null==g?void 0:g.finished.preview_words.map(w))||[],title:"Изученные слова"}),(0,a.jsx)(b,{count:(null==g?void 0:g.current.total_words)||0,bgColor:x.Tj.deck.inProgress.bg,borderColor:x.Tj.deck.inProgress.border,onClick:()=>S(i.IN_PROGRESS),words:(null==g?void 0:g.current.preview_words.map(w))||[],title:"В процессе"}),(0,a.jsx)(b,{count:(null==g?void 0:g.tobe.total_words)||0,bgColor:x.Tj.deck.unlearned.bg,borderColor:x.Tj.deck.unlearned.border,onClick:()=>S(i.NEW),words:(null==g?void 0:g.tobe.preview_words.map(w))||[],title:"Новые слова"}),(0,a.jsx)(b,{count:0,bgColor:x.Tj.deck.add.bg,borderColor:x.Tj.deck.add.border,onClick:()=>{t("add-cards")},isAddDeck:!0,title:"Добавить карточки"})]})})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"日本語"})})}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Нет данных"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Данные не загружены"})]})})})]})};var N=s(7550);let w=e=>{let{setViewMode:t,setCurrentSetIndex:s,setCurrentWordIndex:r,selectedSetList:l,setSelectedSet:i,setCollection:c}=e,o=l.sets;return(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"w-full space-y-12 max-w-screen-lg mx-auto px-4",children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)(n.$,{variant:"ghost",onClick:()=>t("pool"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Все карточки"]})})}),(0,a.jsx)("div",{className:"grid grid-cols-4",children:o.map((e,n)=>(0,a.jsx)(f,{words:e.words,delay:100*n,onClick:()=>{s(n),r(0),i({type:l.type,set:e}),c(l.type),t("study")}},e.id))})]})})};var S=s(4653),k=s(7835),T=s(825),C=s(5196),E=s(2355),A=s(3052),W=s(5273);let R=e=>{let{primary:t,bgColor:s,borderColor:r,color:l,hintColor:n,textSize:i,hintText:c,transformStyle:o,positioningStyle:d,onPlayAudio:u}=e;return(0,a.jsxs)("div",{className:"absolute flex flex-col items-center justify-center ".concat(s," border-2 ").concat(r," shadow-2xl rounded-lg w-full h-full"),style:{backfaceVisibility:"hidden",transform:o,...d},children:[u&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),u()},className:"p-2 mb-4 rounded-full ".concat(n," ").concat((0,x.eV)()," transition-colors"),children:(0,a.jsx)(W.A,{className:"w-4 h-4"})}),(0,a.jsx)("div",{className:"".concat(i," font-normal ").concat(l," mb-6 select-none text-center px-4"),children:t}),(0,a.jsx)("div",{className:"text-xs ".concat(n," text-center px-4"),children:c})]})},I=e=>{let{currentWord:t,currentSide:s,studyMode:l}=e,[n,i]=(0,r.useState)(null),c=(e,t)=>{let s=e.length;return"kanji"===t?s<=2?"text-3xl":s<=4?"text-2xl":s<=6?"text-xl":s<=8?"text-lg":"text-sm":"hiragana"===t?s<=3?"text-3xl":s<=6?"text-xl":s<=10?"text-lg":"text-sm":s<=10?"text-2xl":s<=20?"text-xl":s<=30?"text-lg":"text-base"};(0,r.useEffect)(()=>{let e=()=>{let e=window.speechSynthesis.getVoices();i(e.find(e=>"ja-JP"===e.lang&&e.name.includes("Google"))||e.find(e=>"ja-JP"===e.lang)||null)};return e(),window.speechSynthesis.onvoiceschanged=e,()=>{window.speechSynthesis.onvoiceschanged=null}},[]);let o=(0,r.useCallback)(()=>{if(!n||!t)return;let e=new SpeechSynthesisUtterance(t.reading);e.voice=n,e.lang="ja-JP",e.rate=.9,e.pitch=1,e.volume=1,window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)},[t,n]);if(!t)return null;let d=t.word===t.reading,u={primary:t.word,...(0,x.jP)("kanji"),textSize:c(t.word,"kanji"),onPlayAudio:d?o:void 0},m={primary:t.reading,...(0,x.jP)("hiragana"),textSize:c(t.reading,"hiragana"),onPlayAudio:o},h={primary:t.meaning,...(0,x.jP)("translation"),textSize:c(t.meaning,"translation")},g=(()=>{switch(l){case"jp":case"grid":default:return u;case"translate":return h;case"mixed":return Math.random()>.5?h:u}})(),j=g===u?h:m,p=d?[g,j]:[g,g===u?m:u,j],v="Нажмите для поворота";return"grid"===l?(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)("div",{className:"relative w-full h-full",children:p.map((e,t)=>(0,a.jsx)(R,{...e,hintText:v,transformStyle:"",positioningStyle:{position:"absolute",top:0,left:0,opacity:+(s===t),transition:"opacity 0.2s ease-in-out",pointerEvents:s===t?"auto":"none"}},t))})}):(0,a.jsxs)("div",{className:"relative transition-transform duration-1400 ease-in-out",style:{transformStyle:"preserve-3d",transform:"rotateX(-10deg) rotateY(".concat(-(s*(d?180:120)),"deg)"),width:"200px",height:"280px"},children:[p.map((e,t)=>{let s=d?180*t:120*t;return(0,a.jsx)(R,{...e,hintText:v,transformStyle:"rotateY(".concat(s,"deg) translateZ(174px)")},t)}),p.map((e,t)=>{let s=t-1;return s<0&&(s=p.length-1),(0,a.jsx)("div",{className:"absolute ".concat(p[s].gradientBgColor," shadow-inner"),style:{width:"174px",height:"280px",backfaceVisibility:"hidden",transform:"rotateY(".concat(d?(180*t+60)%360:(120*t+60)%360,"deg) translateZ(-87px)"),opacity:.7}},"bg-".concat(t))})]})},P=e=>{let{activeChunk:t,currentWordIndex:s,currentSide:l,studyMode:c,setViewMode:o,setCurrentWordIndex:d,setCurrentSide:u,setStudyMode:m,onWordsUpdated:h,collection:g,onStartLearning:v,onMarkAsLearned:f}=e,[b,y]=(0,r.useState)(()=>Array(t.length).fill(0));if(0===t.length)return(0,a.jsxs)(p,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)(n.$,{variant:"ghost",onClick:()=>o("set-selection"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Назад"]})})}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Нет слов для изучения"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Выберите другой набор или добавьте новые слова"})]})})]});let w=t[s],W=()=>{u(e=>(e+1)%3)},R=e=>{m(e),d(0),u(0),"grid"===e&&y(Array(t.length).fill(0))},P=e=>{y(s=>{let a=[...s],r=t[e];return r.reading&&""!==r.reading.trim()&&r.reading!=r.word?a[e]=(a[e]+1)%3:a[e]=+(0===a[e]),a})};return(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"w-full space-y-12 max-w-screen-lg mx-auto px-4",children:[(0,a.jsxs)(j,{children:[(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>o("set-selection"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Наборы"]})}),(0,a.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,a.jsx)(n.$,{variant:"grid"===c?"default":"outline",size:"sm",onClick:()=>R("grid"),className:"text-xs",children:(0,a.jsx)(S.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"jp"===c?"default":"outline",size:"sm",onClick:()=>R("jp"),className:"text-xs",children:"漢字"}),(0,a.jsx)(n.$,{variant:"translate"===c?"default":"outline",size:"sm",onClick:()=>R("translate"),className:"text-xs",children:(0,a.jsx)(k.A,{className:"h-3 w-3"})}),(0,a.jsx)(n.$,{variant:"mixed"===c?"default":"outline",size:"sm",onClick:()=>R("mixed"),className:"text-xs",children:(0,a.jsx)(T.A,{className:"h-3 w-3"})})]}),g===i.NEW&&(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{v(),h(),o("set-selection")},children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"Учить"]}),g===i.IN_PROGRESS&&(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{f(),h(),o("set-selection")},children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-1"}),"Выучено"]})]}),"grid"===c?(0,a.jsx)("div",{className:"grid grid-cols-4 gap-4",children:t.map((e,t)=>(0,a.jsx)("div",{className:"cursor-pointer w-[150px] h-[210px]",onClick:e=>{e.target.closest("button")||P(t)},children:(0,a.jsx)(I,{currentWord:e,currentSide:b[t],studyMode:c})},t))}):(0,a.jsxs)("div",{className:"flex items-center justify-between w-full space-x-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"lg",onClick:()=>{d(e=>(e-1+t.length)%t.length),u(0)},className:"rounded-full shadow-md",children:(0,a.jsx)(E.A,{className:"h-6 w-6"})}),(0,a.jsx)("div",{style:{height:320,perspective:"1200px"},onClick:e=>{e.target.closest("button")||W()},children:(0,a.jsx)(I,{currentWord:w,currentSide:l,studyMode:c})}),(0,a.jsx)(n.$,{variant:"outline",size:"lg",onClick:()=>{d(e=>(e+1)%t.length),u(0)},className:"rounded-full shadow-md",children:(0,a.jsx)(A.A,{className:"h-6 w-6"})})]}),"grid"!=c&&(0,a.jsx)("div",{className:"flex justify-center mt-8 space-x-2",children:t.map((e,t)=>(0,a.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300 ".concat(t===s?"".concat(x.Tj.ui.pagination.active," scale-125"):"".concat(x.Tj.ui.pagination.inactive," ").concat(x.Tj.ui.pagination.hover))},t))})]})})})};var L=s(2525);let M=e=>{let{initialWords:t,onSave:s,onCancel:l}=e,[n,i]=(0,r.useState)(t),[c,o]=(0,r.useState)(!1),u=(e,t,s)=>{let a=[...n];a[e]={...a[e],[t]:s},i(a)},m=e=>{i(n.filter((t,s)=>s!==e))},h=async()=>{o(!0);try{let e=d.getInstance();await e.saveWords(n),s()}catch(e){console.error("Error saving words:",e)}finally{o(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium ".concat(x.Tj.ui.text.default),children:"Редактирование слов"}),(0,a.jsxs)("button",{onClick:()=>{i([...n,{word:"",reading:null,translation:""}])},className:"flex items-center px-3 py-1.5 rounded-md bg-slate-200 text-slate-800 hover:bg-slate-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-1"}),"Добавить слово"]})]}),(0,a.jsx)("div",{className:"space-y-4",children:n.map((e,t)=>(0,a.jsx)("div",{className:"p-4 rounded-lg border ".concat(x.Tj.ui.border.default," space-y-3"),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium ".concat(x.Tj.ui.text.secondary," mb-1"),children:"Кандзи"}),(0,a.jsx)("input",{type:"text",value:e.word,onChange:e=>u(t,"word",e.target.value),className:"w-full px-3 py-2 border ".concat(x.Tj.ui.border.default," rounded-md")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium ".concat(x.Tj.ui.text.secondary," mb-1"),children:"Чтение"}),(0,a.jsx)("input",{type:"text",value:e.reading||"",onChange:e=>u(t,"reading",e.target.value),className:"w-full px-3 py-2 border ".concat(x.Tj.ui.border.default," rounded-md")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium ".concat(x.Tj.ui.text.secondary," mb-1"),children:"Перевод"}),(0,a.jsx)("input",{type:"text",value:e.translation,onChange:e=>u(t,"translation",e.target.value),className:"w-full px-3 py-2 border ".concat(x.Tj.ui.border.default," rounded-md")})]})]}),(0,a.jsx)("button",{onClick:()=>m(t),className:"ml-4 p-2 rounded-md bg-red-500 text-white hover:bg-red-600",children:(0,a.jsx)(L.A,{className:"h-4 w-4"})})]})},t))}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:l,className:"px-4 py-2 rounded-md bg-slate-200 text-slate-800 hover:bg-slate-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:"Отмена"}),(0,a.jsx)("button",{onClick:h,disabled:c||0===n.length,className:"px-4 py-2 rounded-md ".concat(c||0===n.length?"bg-gray-400 cursor-not-allowed":"".concat(x.Tj.ui.button.primary.bg," ").concat(x.Tj.ui.button.primary.hoverBg)," ").concat(x.Tj.ui.button.primary.text),children:c?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Сохранение..."]}):"Сохранить"})]})]})},z=()=>{let[e,t]=(0,r.useState)(!1);return e?(0,a.jsx)(M,{initialWords:[{word:"",reading:null,translation:""}],onSave:()=>t(!1),onCancel:()=>t(!1)}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm ".concat(x.Tj.ui.text.secondary," mb-2"),children:"Добавьте новые карточки вручную. Вы можете указать кандзи, чтение и перевод для каждой карточки."}),(0,a.jsx)("button",{onClick:()=>t(!0),className:"w-full ".concat(x.Tj.ui.button.primary.bg," ").concat(x.Tj.ui.button.primary.text," py-2 px-4 rounded-md ").concat(x.Tj.ui.button.primary.hoverBg),children:"Добавить карточки"})]})},B=()=>{let[e,t]=(0,r.useState)(""),[s,l]=(0,r.useState)(!1),[n,i]=(0,r.useState)(null),c=async t=>{if(t.preventDefault(),e.trim()){l(!0);try{let t=d.getInstance(),s=await t.extractWordsFromText(e);i(s)}catch(e){console.error("Error extracting words:",e)}finally{l(!1)}}};return n?(0,a.jsx)(M,{initialWords:n,onSave:()=>{i(null),t("")},onCancel:()=>i(null)}):(0,a.jsxs)("form",{onSubmit:c,className:"space-y-4",children:[(0,a.jsxs)("p",{className:"text-sm ".concat(x.Tj.ui.text.secondary," mb-2"),children:["Введите текст, содержащий японские слова. ИИ автоматически извлечет японские слова, определит чтения для канзи и переведет их на русский. Например:",(0,a.jsx)("br",{}),"今日は天気がいいですね。桜の花が美しいです。",(0,a.jsx)("br",{}),"私は学生です。毎日日本語を勉強しています。"]}),(0,a.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),className:"w-full px-3 py-2 border ".concat(x.Tj.ui.border.default," rounded-md h-48"),placeholder:"Введите текст с японскими словами...",disabled:s}),(0,a.jsx)("button",{type:"submit",disabled:s||!e.trim(),className:"w-full ".concat(s||!e.trim()?"bg-gray-400 cursor-not-allowed":"".concat(x.Tj.ui.button.primary.bg," ").concat(x.Tj.ui.button.primary.hoverBg)," ").concat(x.Tj.ui.button.primary.text," py-2 px-4 rounded-md transition-colors"),children:s?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Извлечение слов..."]}):"Извлечь слова"})]})};var D=s(7213),_=s(6766);let F=()=>{let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),[n,i]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=async e=>{var t;let s=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(s){for(let t of s)if(t.type.startsWith("image/")){e.preventDefault();let s=t.getAsFile();s&&await m(s);break}}};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[]);let m=async e=>{t(e);let s=new FileReader;s.onloadend=()=>{l(s.result)},s.readAsDataURL(e)},h=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&await m(s)},g=async()=>{if(e){i(!0);try{let t=d.getInstance(),s=await e.arrayBuffer(),a=await t.extractWordsFromImage(new Uint8Array(s));o(a)}catch(e){console.error("Error extracting words:",e)}finally{i(!1)}}},j=()=>{t(null),l(null),o(null)};return c?(0,a.jsx)(M,{initialWords:c,onSave:j,onCancel:j}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h3",{className:"text-lg font-medium ".concat(x.Tj.ui.text.default),children:"Загрузка изображения"})}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Поддерживаемые форматы: JPG, PNG. Или просто вставьте изображение из буфера обмена (Ctrl+V)."}),s&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700",children:(0,a.jsx)(_.default,{src:s,alt:"Preview",fill:!0,className:"object-contain",unoptimized:!0})}),(0,a.jsx)("button",{onClick:g,disabled:n,className:"w-full px-4 py-2 rounded-md ".concat(n?"bg-gray-400 cursor-not-allowed":"".concat(x.Tj.ui.button.primary.bg," ").concat(x.Tj.ui.button.primary.hoverBg)," ").concat(x.Tj.ui.button.primary.text),children:n?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Извлечение слов..."]}):"Извлечь слова"})]}),!s&&(0,a.jsxs)("div",{onClick:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.click()},className:"flex flex-col items-center justify-center p-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-gray-400 dark:hover:border-gray-500 transition-colors",children:[(0,a.jsx)(D.A,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mb-4"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"Перетащите изображение сюда или вставьте из буфера обмена (Ctrl+V)"}),(0,a.jsx)("input",{ref:u,type:"file",accept:"image/*",onChange:h,className:"hidden"})]})]})},$=e=>{let{setViewMode:t}=e,[s,l]=(0,r.useState)("manual");return(0,a.jsxs)(p,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)(n.$,{variant:"ghost",onClick:()=>t("pool"),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Все карточки"]})})}),(0,a.jsx)("div",{className:"flex justify-center space-x-4",children:[{mode:"manual",label:"Вручную"},{mode:"free",label:"Из текста"},{mode:"image",label:"Из изображения"}].map(e=>(0,a.jsx)("button",{onClick:()=>l(e.mode),className:"px-4 py-2 rounded-md transition-colors\n                            ".concat(s===e.mode?"".concat(x.Tj.ui.button.modeToggle.activeBg," ").concat(x.Tj.ui.button.modeToggle.activeText):"".concat(x.Tj.ui.button.modeToggle.inactiveBg," ").concat(x.Tj.ui.button.modeToggle.inactiveText," ").concat(x.Tj.ui.button.modeToggle.inactiveHoverBg)),children:e.label},e.mode))}),(0,a.jsxs)("div",{className:"mt-8 max-w-3xl mx-auto px-4",children:["manual"===s&&(0,a.jsx)(z,{}),"free"===s&&(0,a.jsx)(B,{}),"image"===s&&(0,a.jsx)(F,{})]})]})};var O=s(9852),K=s(2657),G=s(5040),V=s(7924),U=s(4416);function J(e){let{onBack:t}=e,[s,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(""),[o,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)([]),[g,v]=(0,r.useState)("grid"),[f,b]=(0,r.useState)(0),y=function(e,t){let[s,a]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let t=setTimeout(()=>{a(e)},300);return()=>{clearTimeout(t)}},[e,300]),s}(i,300);(0,r.useEffect)(()=>{(async()=>{try{u(!0);let e=d.getInstance(),t=await e.getLearnedWords(y||void 0);l(t),h(Array(t.length).fill(0))}catch(e){console.error("Error loading words:",e)}finally{u(!1)}})()},[y]);let w=e=>{h(t=>{let a=[...t],r=s[e];return r.reading&&""!==r.reading.trim()&&r.reading!=r.word?a[e]=(a[e]+1)%3:a[e]=+(0===a[e]),a})},S=()=>{b(e=>(e+1)%s.length)},k=async()=>{let e=s[f];try{await d.getInstance().markAsTobe([e.id]),l(t=>t.filter(t=>t.id!==e.id)),h(e=>e.filter((e,t)=>t!==f)),f>=s.length-1&&b(0)}catch(e){console.error("Error marking word as to be learned:",e)}},T=()=>{h(e=>{let t=[...e],a=s[f];return a.reading&&""!==a.reading.trim()&&a.reading!=a.word?t[f]=(t[f]+1)%3:t[f]=+(0===t[f]),t})};return(0,a.jsx)(p,{children:(0,a.jsxs)("div",{className:"w-full space-y-12 max-w-screen-lg mx-auto px-4",children:[(0,a.jsx)(j,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)(n.$,{variant:"ghost",onClick:t,children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Назад"]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(n.$,{variant:"grid"===g?"default":"outline",size:"sm",onClick:()=>v("grid"),className:"grid"===g?x.Tj.ui.button.modeToggle.activeBg:x.Tj.ui.button.modeToggle.inactiveBg,children:(0,a.jsx)(K.A,{className:"h-4 w-4"})}),(0,a.jsx)(n.$,{variant:"test"===g?"default":"outline",size:"sm",onClick:()=>v("test"),className:"test"===g?x.Tj.ui.button.modeToggle.activeBg:x.Tj.ui.button.modeToggle.inactiveBg,children:(0,a.jsx)(G.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"relative max-w-md",children:[(0,a.jsx)(V.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 ".concat(x.Tj.ui.icon.default)}),(0,a.jsx)(O.p,{type:"text",placeholder:"Поиск...",value:i,onChange:e=>c(e.target.value),className:"pl-8"})]})]})]})}),o?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):"grid"===g?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:s.map((e,t)=>(0,a.jsx)("div",{className:"cursor-pointer w-[150px] h-[210px]",onClick:e=>{e.target.closest("button")||w(t)},children:(0,a.jsx)(I,{currentWord:e,currentSide:m[t],studyMode:"grid"})},e.id))}):(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)("div",{className:"w-[300px] h-[420px] cursor-pointer flex justify-center",onClick:e=>{e.target.closest("button")||T()},children:(0,a.jsx)(I,{currentWord:s[f],currentSide:m[f],studyMode:"jp"})}),(0,a.jsxs)("div",{className:"flex justify-center w-full space-x-4",children:[(0,a.jsxs)(n.$,{variant:"outline",size:"lg",onClick:k,className:"".concat(x.Tj.ui.button.modeToggle.inactiveBg," ").concat(x.Tj.ui.button.modeToggle.inactiveText," hover:").concat(x.Tj.ui.button.modeToggle.inactiveHoverBg),children:[(0,a.jsx)(U.A,{className:"h-4 w-4 mr-2"}),"Не знаю"]}),(0,a.jsxs)(n.$,{variant:"outline",size:"lg",onClick:()=>{S()},className:"".concat(x.Tj.ui.button.modeToggle.inactiveBg," ").concat(x.Tj.ui.button.modeToggle.inactiveText," hover:").concat(x.Tj.ui.button.modeToggle.inactiveHoverBg),children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Знаю"]})]})]})]})})}function X(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}),children:(0,a.jsx)(Y,{})})}function Y(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),[s,c]=(0,r.useState)("pool"),[o,x]=(0,r.useState)(i.LEARNED),[u,m]=(0,r.useState)(0),[h,g]=(0,r.useState)(0),[p,v]=(0,r.useState)("grid"),[f,b]=(0,r.useState)(null),[N,S]=(0,r.useState)(null),[k,T]=(0,r.useState)(!1),[C,E]=(0,r.useState)(!0),A=async()=>{if(null==f?void 0:f.set){E(!0);try{let e=d.getInstance();await e.moveToInProgress(f.set.id),x(i.IN_PROGRESS),c("set-selection"),await I()}catch(e){console.error("Error starting learning:",e)}finally{E(!1)}}},W=async()=>{if(null==f?void 0:f.set){E(!0);try{let e=d.getInstance();await e.markAsFinished(f.set.id),x(i.LEARNED),c("set-selection"),await I()}catch(e){console.error("Error marking as learned:",e)}finally{E(!1)}}},R=(0,r.useCallback)((t,s)=>{let a=new URLSearchParams;a.set("type",t),s&&a.set("setId",s),e.push("?".concat(a.toString()))},[e]),I=(0,r.useCallback)(async()=>{if(k)try{f||b({type:o,set:null})}catch(e){console.error("Error refreshing words:",e)}},[k,o,f]),L=async()=>{await I()};return((0,r.useEffect)(()=>{let e=async()=>{let e=d.getInstance();try{let s=t.get("type"),a=t.get("setId");if(s||a){let t=Object.values(i).includes(s)?s:i.NEW;if(b({type:t,set:null}),x(t),a)try{let s=await e.getSetById(a);s&&(b(()=>({type:t,set:s})),c("study"))}catch(e){console.error("Error loading specific set:",e)}else if(s)try{let s=[];switch(t){case i.LEARNED:let a=await e.getLearnedWords(void 0);s=[{id:"learned",words:a,state:i.LEARNED}];break;case i.IN_PROGRESS:s=await e.getInProgressSets();break;case i.NEW:s=await e.getUnlearnedSets()}S({type:t,sets:s}),c("set-selection")}catch(e){console.error("Error loading sets for type:",e)}}}catch(e){console.error("Error initializing data:",e)}finally{E(!1)}};(async()=>{await e(),T(!0)})()},[t]),(0,r.useEffect)(()=>{k&&I()},[o,k,I]),!k||C)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):(0,a.jsxs)(a.Fragment,{children:[C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white"})}),"study"===s&&f&&f.set&&(0,a.jsx)(P,{activeChunk:f.set.words||[],currentWordIndex:u,currentSide:h,studyMode:p,setViewMode:t=>{c(t),("set-selection"===t||"pool"===t)&&(e.push("/"),"pool"===t&&(b(null),S(null),m(0),g(0)))},setCurrentWordIndex:m,setCurrentSide:g,setStudyMode:v,onWordsUpdated:L,collection:f.type,onStartLearning:A,onMarkAsLearned:W}),"set-selection"===s&&N&&N.sets&&N.sets.length>0&&(N.type===i.LEARNED?(0,a.jsx)(J,{onBack:()=>{c("pool"),e.push("/"),b(null),S(null),m(0),g(0),x(i.LEARNED)}}):(0,a.jsx)(w,{setViewMode:t=>{c(t),"pool"===t&&(e.push("/"),b(null),S(null),m(0),g(0),x(i.LEARNED))},setCurrentSetIndex:e=>{x([i.LEARNED,i.IN_PROGRESS,i.NEW][e])},setCurrentWordIndex:m,selectedSetList:N,setSelectedSet:e=>{var t;b(e),x(e.type),R(e.type,null===(t=e.set)||void 0===t?void 0:t.id)},setCollection:e=>{x(e),b(t=>t?{...t,type:e}:{type:e,set:null})}})),"pool"===s&&(0,a.jsx)(y,{setViewMode:t=>{c(t),"pool"===t&&(e.push("/"),b(null),S(null))},setSelectedSetList:S,setSelectedSet:b}),"set-selection"===s&&(!N||!N.sets||0===N.sets.length)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{children:(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)(n.$,{variant:"ghost",onClick:()=>c("pool"),children:"Все карточки"})})}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Нет доступных наборов"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"В данной категории пока нет наборов для изучения"})]})})]}),"add-cards"===s&&(0,a.jsx)($,{setViewMode:c})]})}},7868:(e,t,s)=>{Promise.resolve().then(s.bind(s,2867))}},e=>{var t=t=>e(e.s=t);e.O(0,[56,408,271,441,684,358],()=>t(7868)),_N_E=e.O()}]);